<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhóm 4</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css">
    <style>
        .thuchien {
            color:rgb(255, 255, 255);
            background-color: rgb(16, 164, 115);
        }
        
    </style>
</head>
<body>
    <section class="sec_head">
        <header>
            <a href="https://www.ctu.edu.vn/"><img class="ctulogo" src="./img/ctu.png" alt="ctu"></a>
            <ul>
                <li><a href="index.html" class="trangchu"><i class="fa fa-house"></i> Trang chủ</a></li>
                <li><a href="thuchien.html" class="thuchien"><i class="fa fa-laptop-file"></i> Thực hiện</a></li>
                <li><a href="capnhat.html" class="capnhat"><i class="fa fa-arrows-rotate"></i> Cập nhật</a></li>
                <li><a href="bieudo.html" class="bieudo"><i class="fa fa-chart-line"></i> Biểu đồ</a></li>
                <li><a href="thanhvien.html" class="thanhvien"><i class="fa fa-people-group"></i> Thành viên</a></li>
                <li><a href="lienhe.html" class="lienhe"><i class="fa fa-address-card"></i> Liên hệ</a></li>
            </ul>
            <a href="https://github.com/NguyenNhatTruongCTU/cuoi_ki"><img class="githublogo" src="./img/github.png" alt="github"></a>
        </header>
    </section> 
    
   
    <h1 class="tittle">Trạm thời tiết mini với cảm biến BMP280</h1>
    
    <section class="tongquan esp">
        <h3 style="font-size: 26px; font-weight: 250;">Tổng quan về ESP8266</h3>
        <p>
            ESP8266 là một chip của Espressif Systems có tích hợp công nghệ Wi-Fi với đặc tính giá rẻ, tương thích 
            với nhiều nền tảng. Nó thường được sử dụng trong các board mạch smart home giá rẻ như Sonoff Basic và 
            các công tắc Wi-Fi. Module sơ khai nhất của ESP8266 là ESP-01.
        </p>
        <img src="./img/espthuc.png" alt="">
        <ul>
            <li>Điện áp hoạt động: 3.3V</li>
            <li>Bộ xử lý: Lõi vi xử lý L106 32-bit RISC dựa trên tiêu chuẩn Tensilica Xtensa Diamond, 
                hoạt động ở tần số 80 MHz và SRAM trên chip.</li>
            <li>17 chân GPIO: Các chân có thể được dồn kênh cho các chức năng I²C, 
                I2S, UART, PWM, IR - điều khiển từ xa,...</li>
            <li>2 hardware timer 23 bit: FRC1 và FRC2.</li>
            <li>3 SPI: general Slave/Master SPI, Slave SDIO/SPI và general Slave/Master HSPI.</li>
            <li>I²C: Hỗ trợ 1 I²C hoạt động được ở cả chế độ master và slave. 
                Các GPIO đều có thể được cấu hình cho các chân SDA hay SCL của I²C bằng phần mềm.</li>
            <li>Giao diện I²S với DMA (sử dụng chung chân với GPIO)</li>
            <li>UART: Hỗ trợ 2 UART là UART0 và UART1.</li>
            <li>ADC 10 bit</li>
            <li>WiFi: 2.4 GHz hỗ trợ chuẩn 802.11 b/g/n</li>
        </ul>
        <img src="./img/esppinout.png" alt="">
    </section>
    
    <section class="tongquan bmp">
        <h3 style="font-size: 26px; font-weight: 250;">Tổng quan về BMP280</h3>
        <p>
            Cảm biến áp suất I2C BMP280 3.3V với chi phí thấp, độ chính xác cao, tiêu thụ điện năng thấp rất phù hợp 
            với những ứng dụng thiết bị di động. Cảm biến áp suất IIC I2C có thể đo được áp suất khí quyển với độ chính 
            xác ± 12 hPa và đo được nhiệt độ với độ chính xác ± 1.0°C. Ngoài ra, cảm biến còn có thể đo được độ cao 
            (ứng dụng việc áp suất khí quyển thay đổi theo độ cao).
        </p>
        <img src="./img/bmp.jpg" alt="">
        <h4>Thông số kĩ thuật</h4>
        <ul>
            <li>Khoản đo áp suất : 300-1100 hPa ( tương ứng với + 9000 …- 500m so với mặt nước biển)</li>
            <li>Độ chính xác tương đối ± 12 hPa (tương ứng với ± 1 m 950 ~ 1050hPa @ 25°C)</li>
            <li>Độ chính xác tuyệt đối : ± 1 hPa (950 … 1050 hPa, 0 ~+ 40 ° C)</li>
            <li>Khoản đo nhiệt độ: -40 - + 85 ° C</li>
            <li>Điện áp hoạt động: 3.3.</li>
            <li>Dòng tiêu thụ: 0,6 mA</li>
            <li>Kích thước 11.5 x 14.5mm</li>
        </ul>
        
    </section class="thietkemach">
        <h3 style="margin: 10px 200px; font-size: 26px; font-weight: 250;">Thiết kế mạch điện</h3>
        <img style="margin: 10px 300px;" src="./img/machthietke.png" alt="">
        <h3 style="margin: 10px 200px; font-size: 26px; font-weight: 250;">Mạch thực tế</h3>
        <img style="margin: 10px 300px; width: 600px;" src="./img/thucte.jpg" alt="">
    <section>

    <section class="laptrinh">
        <h3 style="font-size: 26px; font-weight: 250;">Lập trình</h3>
        <p>Thực hiện lập trình cho ESP8266 thông qua phần mềm Arduino IDE</p>
        <a href="https://github.com/NguyenNhatTruongCTU/cuoi_ki/tree/main/thingspeak_esp" class="link_code">Link code chương trình</a>
        <p>Code chương trình:</p>
        
        <pre>
            <code style="overflow: scroll; height: 700px;">
            
            
  #define TS_ENABLE_SSL // For HTTPS SSL connection

  #define SECRET_SSID "oanhnguyen"    // replace MySSID with your WiFi network name
  #define SECRET_PASS "oanhnguyen"  // replace MyPassword with your WiFi password

  #define SECRET_CH_ID 1713269     // replace 0000000 with your channel number
  #define SECRET_WRITE_APIKEY "DM02SEJGCBE6FNG0"   // replace XYZ with your channel write API Key

  // ThingSpeak Certificate Fingerprint, Expiration Date: August 3, 2022 at 8:00:00 AM EST 
  #define SECRET_SHA1_FINGERPRINT "27 18 92 DD A4 26 C3 07 09 B9 7A E6 C5 21 B9 5B 48 F7 16 E1"

  #include <ESP8266WiFi.h>
  #include <WiFiClientSecure.h>
  #include "ThingSpeak.h" // always include thingspeak header file after other header files and custom macros

  char ssid[] = SECRET_SSID;   // your network SSID (name) 
  char pass[] = SECRET_PASS;   // your network password
  int keyIndex = 0;            // your network key Index number (needed only for WEP)
  WiFiClientSecure  client;

  unsigned long myChannelNumber = SECRET_CH_ID;
  const char * myWriteAPIKey = SECRET_WRITE_APIKEY;

  // Initialize our values


  String myStatus = "";

  // Fingerprint check, make sure that the certificate has not expired.
  const char * fingerprint = NULL; // use SECRET_SHA1_FINGERPRINT for fingerprint check

  #include <Adafruit_BMP280.h>
  Adafruit_BMP280 bmp; // I2C Interface

  void setup() {
    
    Serial.begin(115200);  // Initialize serial
    while (!Serial) {
      ; // wait for serial port to connect. Needed for Leonardo native USB port only
    }
    
    WiFi.mode(WIFI_STA); 

    if(fingerprint!=NULL){
      client.setFingerprint(fingerprint);
    }
    else{
      client.setInsecure(); // To perform a simple SSL Encryption
    }
    
    ThingSpeak.begin(client);  // Initialize ThingSpeak

    //  connect to bmp280
    if (!bmp.begin(0x76)) {
    Serial.println(F("Could not find a valid BMP280 sensor, check wiring!"));
    while (1);
    }

    /* Default settings from datasheet. */
    bmp.setSampling(Adafruit_BMP280::MODE_NORMAL,     /* Operating Mode. */
                    Adafruit_BMP280::SAMPLING_X2,     /* Temp. oversampling */
                    Adafruit_BMP280::SAMPLING_X16,    /* Pressure oversampling */
                    Adafruit_BMP280::FILTER_X16,      /* Filtering. */
                    Adafruit_BMP280::STANDBY_MS_500); /* Standby time. */

  }

  void loop() {
    
    // Connect or reconnect to WiFi
    if(WiFi.status() != WL_CONNECTED){
      Serial.println();
      Serial.print("Attempting to connect to SSID: ");
      Serial.println(SECRET_SSID);
      while(WiFi.status() != WL_CONNECTED){
        WiFi.begin(ssid, pass);  // Connect to WPA/WPA2 network. Change this line if using open or WEP network
        Serial.println("...");
        delay(5000);     
      } 
    
      Serial.println("WiFi connected");
      Serial.println("IP address: ");
      Serial.println(WiFi.localIP());
    }

    //  display temperature on serial monitor
    Serial.print(F("Temperature = "));
    Serial.print(bmp.readTemperature());
    Serial.println("*C");
    
    //  display pressure on serial monitor
    Serial.print(F("Pressure = "));
    Serial.print(bmp.readPressure()/100000); //displaying the Pressure in hPa, you can change the unit
    Serial.println("Bar");

    //  read data from bmp280 sensor
    float number1 = bmp.readTemperature();
    float number2 = bmp.readPressure()/100000;

    // set the fields with the values
    ThingSpeak.setField(1, number1);
    ThingSpeak.setField(2, number2);

    // figure out the status message
    if(number1 > number2){
      myStatus = String("field1 is greater than field2"); 
    }
    else if(number1 < number2){
      myStatus = String("field1 is less than field2");
    }
    else{
      myStatus = String("field1 equals field2");
    }
    
    // set the status
    ThingSpeak.setStatus(myStatus);
    
    // write to the ThingSpeak channel
    int x = ThingSpeak.writeFields(myChannelNumber, myWriteAPIKey);
    if(x == 200){
      Serial.println("Channel update successful.");
    }
    else{
      Serial.println("Problem updating channel. HTTP error code " + String(x));
    };

    float time1 = millis();

  //  checking button status

    while ((millis()-time1)/1000<1800){
      int stat = ThingSpeak.readFloatField(myChannelNumber, 3);
      Serial.print("stat: ");
      Serial.println(stat);
      if (stat == 1) {

            //  read data from bmp280 sensor
            float number1 = bmp.readTemperature();
            float number2 = bmp.readPressure()/100000;
        
            // set the fields with the values
            ThingSpeak.setField(1, number1);
            ThingSpeak.setField(2, number2);
            ThingSpeak.setField(3, 0);
        
            // figure out the status message
            if(number1 > number2){
              myStatus = String("field1 is greater than field2"); 
            }
            else if(number1 < number2){
              myStatus = String("field1 is less than field2");
            }
            else{
              myStatus = String("field1 equals field2");
            }
          
            // set the status
            ThingSpeak.setStatus(myStatus);
          
            // write to the ThingSpeak channel
            int x = ThingSpeak.writeFields(myChannelNumber, myWriteAPIKey);
            if(x == 200){
              Serial.println("Channel update successful.");
            }
            else{
              Serial.println("Problem updating channel. HTTP error code " + String(x));
            }
      } else {
            delay(1000);
        }
    } 

  }
            </code>
        </pre>

    </section>

    </section>
  

    <section>
        <footer>
            <p>Copyright &copy; 2022 - Nhóm 4 - All Right Reserved.</p>
        </footer>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
